function [w, b] = TrainSVM(Xtrain, ys, lambda, T)
%TRAINSVM Summary of this function goes here
%   Detailed explanation goes here
w = 0;
b = 0;

% ? for t = 1,2,...,T
XtrainT = transpose(Xtrain);
[N,d]=size(XtrainT);
% lambda = 1; % who knows how big this is
k = ceil(0.1*N);
w=rand(1,size(XtrainT, 2));
w=w/(sqrt(lambda)*norm(w));
maxIter = T;
Y = ys;

for t=1:maxIter
    b = mean(Y-XtrainT*w(t,:)');
    idx = randint(k,1,[1,size(XtrainT,1)]);
    At = XtrainT(idx,:);
    yt = Y(idx,:);
    idx1 = (At*w(t,:)'+b).*yt<1;
    etat = 1/(lambda*t);
    w1 = (1-etat*lambda)*w(t,:)+(etat/k)*sum(At(idx1,:).*repmat(yt(idx1,:),1,size(At,2)),1);
    w(t+1,:)=min(1,1/(sqrt(lambda)*norm(w1)))*w1;
end

wT=mean(w,1);
w = wT;
b=mean(Y-XtrainT*wT');
Tr=sum(sign(XtrainT*wT'+b)==Y);
F=size(XtrainT,1)-Tr;

end

